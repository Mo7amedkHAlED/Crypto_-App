//
//  MarketDataModel.swift
//  Crypto SwiftUI
//
//  Created by Mohamed Khaled Gomaa on 24/11/2023.
//

import Foundation
 //URL:- https://api.coingecko.com/api/v3/global
// JSON Data
/*
{
  "data": {
    "active_cryptocurrencies": 11103,
    "upcoming_icos": 0,
    "ongoing_icos": 49,
    "ended_icos": 3376,
    "markets": 935,
    "total_market_cap": {
      "btc": 39431594.771846645,
      "eth": 712006273.6317742,
      "ltc": 21387430587.364677,
      "bch": 6615960864.746571,
      "bnb": 6411757884.006693,
      "eos": 2204840605105.575,
      "xrp": 2424205405462.733,
      "xlm": 12751642801389.965,
      "link": 103542956763.34169,
      "dot": 287537102570.9401,
      "yfi": 171061479.61660084,
      "usd": 1510307684127.3623,
      "aed": 5546793758418.244,
      "ars": 539977738782992.25,
      "aud": 2292965739426.684,
      "bdt": 166401446100406.5,
      "bhd": 569247048609.0752,
      "bmd": 1510307684127.3623,
      "brl": 7404887544508.035,
      "cad": 2054266140873.4065,
      "chf": 1331866341555.3955,
      "clp": 1317350774403250.8,
      "cny": 10798699941510.623,
      "czk": 33721394817353.65,
      "dkk": 10292263568869.04,
      "eur": 1380572254060.8188,
      "gbp": 1197433854591.22,
      "hkd": 11770081514095.453,
      "huf": 524766977003838.3,
      "idr": 23468628700256500,
      "ils": 5641477967751.549,
      "inr": 125908607925575.1,
      "jpy": 225795152123171.56,
      "krw": 1969557296309450.5,
      "kwd": 465552343632.25714,
      "lkr": 495968319830439.06,
      "mmk": 3169564923616884.5,
      "mxn": 25868876240193.188,
      "myr": 7075036346294.611,
      "ngn": 1237697147142373.5,
      "nok": 16139587412121.045,
      "nzd": 2481988297633.6455,
      "php": 83704277000629.5,
      "pkr": 431570420739394.7,
      "pln": 6033645971319.763,
      "rub": 133996011064079.06,
      "sar": 5664387825012.072,
      "sek": 15776560795318.082,
      "sgd": 2022732426736.5103,
      "thb": 53380314787797.46,
      "try": 43607113763809.23,
      "twd": 47780849048895.27,
      "uah": 54478524448156.945,
      "vef": 151227108411.67245,
      "vnd": 36662416321222530,
      "zar": 28461847987687.234,
      "xdr": 1133680746628.8376,
      "xag": 62382337605.193474,
      "xau": 755773068.2141709,
      "bits": 39431594771846.65,
      "sats": 3943159477184664.5
    },
    "total_volume": {
      "btc": 2770401.5413859384,
      "eth": 50024435.71859491,
      "ltc": 1502647078.0183718,
      "bch": 464826956.23889357,
      "bnb": 450479977.48059905,
      "eos": 154908616966.6155,
      "xrp": 170320841213.48248,
      "xlm": 895910273895.3015,
      "link": 7274764530.234735,
      "dot": 20201902478.89569,
      "yfi": 12018509.257453406,
      "usd": 106111831395.18555,
      "aed": 389708964777.7427,
      "ars": 37937982688607.28,
      "aud": 161100149654.31586,
      "bdt": 11691102666092.498,
      "bhd": 39994398147.49655,
      "bmd": 106111831395.18555,
      "brl": 520255698147.4546,
      "cad": 144329493037.80093,
      "chf": 93574824627.67557,
      "clp": 92554983816136.66,
      "cny": 758699594475.5756,
      "czk": 2369211915476.003,
      "dkk": 723118175172.1421,
      "eur": 96996825078.3389,
      "gbp": 84129810515.19016,
      "hkd": 826947328850.3544,
      "huf": 36869298601076.805,
      "idr": 1648868768854007.2,
      "ils": 396361327711.5691,
      "inr": 8846139840121.799,
      "jpy": 15864010601116.545,
      "krw": 138377983470235.58,
      "kwd": 32708972027.56579,
      "lkr": 34845950453869.875,
      "mmk": 222688623189555.94,
      "mxn": 1817506368292.3164,
      "myr": 497080874170.7455,
      "ngn": 86958645828354.58,
      "nok": 1133941908831.8867,
      "nzd": 174380575912.5804,
      "php": 5880930237919.452,
      "pkr": 30321455821174.336,
      "pln": 423914431963.4757,
      "rub": 9414348005435.92,
      "sar": 397970938082.0023,
      "sek": 1108436232366.7512,
      "sgd": 142113984110.1008,
      "thb": 3750416568831.436,
      "try": 3063766907873.1855,
      "twd": 3357006953933.7866,
      "uah": 3827575044247.63,
      "vef": 10624977677.599907,
      "vnd": 2575843439123758.5,
      "zar": 1999684466023.1396,
      "xdr": 79650617888.33673,
      "xag": 4382884467.560995,
      "xau": 53099421.54846463,
      "bits": 2770401541385.9385,
      "sats": 277040154138593.84
    },
    "market_cap_percentage": {
      "btc": 49.583873320689335,
      "eth": 16.889823505208742,
      "usdt": 5.871389991039469,
      "bnb": 2.4009953279680047,
      "xrp": 2.2158891865564336,
      "sol": 1.632288575735406,
      "usdc": 1.626719611185292,
      "steth": 1.2887938082960262,
      "ada": 0.9098717105882657,
      "doge": 0.7328939411855673
    },
    "market_cap_change_percentage_24h_usd": 3.2214332954864164,
    "updated_at": 1700841885
  }
}
*/
// MARK: - MarketData
struct GlobalData : Codable {
    let data: MarketDataModel
}

// MARK: - DataClass
struct MarketDataModel: Codable {
    let totalMarketCap, totalVolume, marketCapPercentage: [String : Double]?
    let marketCapChangePercentage24HUSD: Double

    enum CodingKeys: String, CodingKey {
        case totalMarketCap = "total_market_cap"
        case totalVolume = "total_volume"
        case marketCapPercentage = "market_cap_percentage"
        case marketCapChangePercentage24HUSD = "market_cap_change_percentage_24h_usd"
    }
    
    var marketCap: String {
        if let item = totalMarketCap?.first(where: {$0.key == "usd"}) {
            return "\(item.value)"
        }
        return ""
    }
    
    var volume: String {
        if let item = totalVolume?.first(where: {$0.key == "usd"}) {
            return "\(item.value)"
        }
        return ""
    }
    
    var btcDominance: String {
        if let item = marketCapPercentage?.first(where: {$0.key == "btc"}) {
            return "\(item.value.asPercentString())"
        }
        return ""
    }
}
